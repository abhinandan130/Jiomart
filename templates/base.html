{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}JioMart{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <link rel="icon" type="image/x-icon" href="{% static 'images/favicon.ico' %}">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Base CSS -->
    <link rel="stylesheet" href="{% static 'css/base.css' %}">
</head>

<body
  class="d-flex flex-column min-vh-100"
  data-authenticated="{% if request.session.user_id %}true{% else %}false{% endif %}">

<!-- ================= NAVBAR ================= -->

<!-- ================= ROW 1 : LOGO + SEARCH + CART + PROFILE ================= -->
<nav class="navbar navbar-expand-lg jm-midbar">
    <div class="container">

        <!-- LOGO -->
        <a class="navbar-brand fw-bold fs-3 text-white" href="{% url 'product_list' %}">
            JioMart
        </a>

        <!-- SEARCH BOX -->
        <div class="right-icons d-flex align-items-center gap-3">

            <form
                class="search position-relative"
                method="GET"
                action="/"
                autocomplete="off"
            >
                <input
                    id="search-input"
                    name="q"
                    class="form-control rounded-pill px-3"
                    type="search"
                    placeholder="Search for groceries, fruits, snacks..."
                >

                <!-- SEARCH DROPDOWN (STRUCTURED) -->
                <div id="search-dropdown" class="search-dropdown shadow-sm d-none">

                    <!-- LEFT: SUGGESTIONS -->
                    <div class="search-left">
                        <ul id="search-suggestions" class="list-unstyled mb-0"></ul>
                    </div>

                    <!-- RIGHT: RESULTS -->
                    <div class="search-right">

                        <!-- PRODUCTS -->
                        <div id="search-products" class="search-products-grid"></div>

                        <!-- CATEGORIES -->
                        <div class="mt-3">
                            <h6 class="fw-semibold mb-2">Categories</h6>
                            <div id="search-categories" class="d-flex flex-wrap gap-2"></div>
                        </div>

                        <!-- BRANDS -->
                        <div class="mt-3">
                            <h6 class="fw-semibold mb-2">Brands</h6>
                            <div id="search-brands" class="d-flex flex-wrap gap-2"></div>
                        </div>

                    </div>
                </div>
            </form>

            <!-- RIGHT ICONS -->
            <ul class="navbar-nav align-items-center gap-4 mb-0">

                <!-- CART -->
                <li class="nav-item position-relative cart-hover">
                    <a href="{% url 'cart:cart_page' %}"
                       class="nav-link nav-link-no-style d-flex align-items-center">

                        <i class="bi bi-cart3 fs-5"></i>

                        <span id="cart-count"
                              class="badge bg-danger rounded-pill ms-1"
                              style="font-size:10px; display:none;">
                        </span>
                    </a>

                    <div class="cart-dropdown shadow">

                        {% if not request.session.user_id %}
                            <div class="text-center py-3 text-muted">
                                <i class="bi bi-lock fs-5"></i><br>
                                Please login to see cart items
                            </div>
                        {% else %}

                            <div id="cart-hover-empty" class="text-center py-3 text-muted d-none">
                                Cart is empty
                            </div>

                            <div id="cart-hover-items" class="d-flex flex-column gap-2">
                                <div id="cart-hover-content"></div>
                                <div id="cart-hover-total"
                                     class="fw-bold text-end mt-2 mb-2">
                                </div>

                                <a href="{% url 'cart:cart_page' %}"
                                   class="btn btn-primary btn-sm w-100">
                                    View Cart
                                </a>
                            </div>

                        {% endif %}
                    </div>
                </li>

                {% if request.session.user_id %}
                <!-- PROFILE -->
                <li class="nav-item dropdown">
                    <a class="dropdown-toggle nav-link-no-style d-flex align-items-center gap-1 account-dropdown"
                        href="#"
                        data-bs-toggle="dropdown">
                        <i class="bi bi-person-circle fs-5"></i>
                        <span class="fw-semibold">{{ user.name }}</span>
                    </a>

                    <ul class="dropdown-menu dropdown-menu-end shadow-sm">
                        <li>
                            <a class="dropdown-item" href="{% url 'accounts:profile' %}">
                                <i class="bi bi-person me-2"></i> My Profile
                            </a>
                        </li>

                        <li>
                            <a class="dropdown-item" href="{% url 'orders:my_orders' %}">
                                <i class="bi bi-bag-check me-2"></i> My Orders
                            </a>
                        </li>

                        <li><hr class="dropdown-divider"></li>

                        <li>
                            <a class="dropdown-item text-danger" href="{% url 'accounts:logout' %}">
                                <i class="bi bi-box-arrow-right me-2"></i> Logout
                            </a>
                        </li>
                    </ul>
                </li>
                {% else %}
                <!-- LOGIN -->
                <li class="nav-item">
                    <a class="nav-link nav-link-no-style fw-semibold d-flex align-items-center gap-2"
                       href="{% url 'accounts:login' %}">
                        <i class="bi bi-person-circle fs-5"></i> Login
                    </a>
                </li>
                {% endif %}

            </ul>
        </div>
    </div>
</nav>



<!-- ================= ROW 2 : Middle BLUE BAR ================= -->
<div class="jm-topbar">
    <div class="container d-flex justify-content-between">

        <div>
            <i class="bi bi-geo-alt-fill me-1"></i>

            {% if user_location %}
                Delivering to: <strong>{{ user_location }}</strong>
            {% else %}
                Select your location
            {% endif %}
        </div>

        <div>
            <i class="bi bi-lightning-charge-fill me-1"></i>
            Best Prices | Trusted by Millions
        </div>
    </div>
</div>


<!-- ================= ROW 3 : CATEGORY BLUE BAR ================= -->
<!-- ================= ROW 3 : CATEGORY SLIDER ================= -->
{% if not hide_navitems %}
<div class="nav w-100 justify-content-center align-items-center">
    <div class="jm-carousel-wrapper">

        <button class="carousel-btn left" onclick="scrollNav(-300)">
            <i class="bi bi-chevron-left"></i>
        </button>

        <div class="nav-scroll" id="navScroll">
            <ul class="nav nav-pills">

                <li class="nav-item">
                    <a class="nav-link {% if active_category == 'live' %}active{% endif %}"
                       href="{% url 'product_by_category' 'live' %}">
                        <img src="{% static 'icons/1.gif' %}" class="nav-icon"> Live Now
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link {% if active_category == 'all' %}active{% endif %}"
                    href="{% url 'product_list' %}">
                        <img src="{% static 'icons/2.png' %}" class="nav-icon"> Everything Store
                    </a>
                </li>


                <li class="nav-item">
                    <a class="nav-link {% if active_category == 'essentials' %}active{% endif %}"
                       href="{% url 'product_by_category' 'essentials' %}">
                        <img src="{% static 'icons/3.png' %}" class="nav-icon"> Everyday Essentials
                    </a>
                </li>


                <li class="nav-item">
                    <a class="nav-link {% if active_category == 'hour' %}active{% endif %}"
                       href="{% url 'product_by_category' 'hour' %}">
                        <img src="{% static 'icons/4.png' %}" class="nav-icon"> Happy Hour Store
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link {% if active_category == 'fashion' %}active{% endif %}"
                       href="{% url 'product_by_category' 'fashion' %}">
                        <img src="{% static 'icons/5.png' %}" class="nav-icon"> Fashion
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link {% if active_category == '999' %}active{% endif %}"
                       href="{% url 'product_by_category' '999' %}">
                        <img src="{% static 'icons/6.png' %}" class="nav-icon"> 99 to 999
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link {% if active_category == 'smartphones' %}active{% endif %}"
                       href="{% url 'product_by_category' 'smartphones' %}">
                        <img src="{% static 'icons/7.png' %}" class="nav-icon"> Smartphone Deals
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link {% if active_category == 'lifestyle' %}active{% endif %}"
                       href="{% url 'product_by_category' 'lifestyle' %}">
                        <img src="{% static 'icons/8.png' %}" class="nav-icon"> Home & Lifestyle
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link {% if active_category == 'electronics' %}active{% endif %}"
                       href="{% url 'product_by_category' 'electronics' %}">
                        <img src="{% static 'icons/9.png' %}" class="nav-icon"> Electronics
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link {% if active_category == 'groceries' %}active{% endif %}"
                       href="{% url 'product_by_category' 'groceries' %}">
                        <img src="{% static 'icons/10.png' %}" class="nav-icon"> Groceries
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link {% if active_category == 'global' %}active{% endif %}"
                       href="{% url 'product_by_category' 'global' %}">
                        <img src="{% static 'icons/11.png' %}" class="nav-icon"> Global Store
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link {% if active_category == 'local' %}active{% endif %}"
                       href="{% url 'product_by_category' 'local' %}">
                        <img src="{% static 'icons/12.png' %}" class="nav-icon"> Local Shops
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link {% if active_category == 'milkbasket' %}active{% endif %}"
                       href="{% url 'product_by_category' 'dairy' %}">
                        <img src="{% static 'icons/13.png' %}" class="nav-icon"> Milkbasket
                    </a>
                </li>

            </ul>
        </div>

        <button class="carousel-btn right" onclick="scrollNav(300)">
            <i class="bi bi-chevron-right"></i>
        </button>

    </div>
</div>

{% endif %}

<!-- ============================================== -->
<!-- ================= END NAVBAR ================= -->
<!-- ============================================== -->


<!-- ================= PAGE CONTENT ================= -->
<div class="container-fluid bg-white py-4">

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} text-center">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    {% block content %}{% endblock %}

</div>
<!-- ================= END PAGE CONTENT ================= -->



<!-- ================= Footer CONTENT ================= -->
{% if not hide_footer %}
    <footer class="jm-footer mt-5 pt-5">
        <div class="container">
            <div class="row gy-4">

                <!-- All Categories -->
                <div class="col-md-2 col-sm-6">
                    <h6 class="footer-title">All Categories</h6>
                    <ul class="footer-list">
                        <li>Grocery</li>
                        <li>Electronics</li>
                        <li>Fashion</li>
                        <li>Home & Lifestyle</li>
                        <li>Premium Fruits</li>
                        <li>Books</li>
                        <li>Furniture</li>
                    </ul>
                </div>

                <!-- Popular Categories -->
                <div class="col-md-3 col-sm-6">
                    <h6 class="footer-title">Popular Categories</h6>
                    <ul class="footer-list">
                        <li>Biscuits, Drinks & Packaged Foods</li>
                        <li>Fruits & Vegetables</li>
                        <li>Cooking Essentials</li>
                        <li>Dairy & Bakery</li>
                        <li>Personal Care</li>
                        <li>Beauty</li>
                        <li>Home</li>
                    </ul>
                </div>

                <!-- Customer Account -->
                <div class="col-md-2 col-sm-6">
                    <h6 class="footer-title">Customer Account</h6>
                    <ul class="footer-list">
                        <li>
                            <a href="{% url 'accounts:profile' %}" class="footer-link">My Account</a>
                        </li>
                        <li>My Orders</li>
                        <li>Wishlist</li>
                        <li>Delivery Addresses</li>
                        <li>JioMart Wallet</li>
                    </ul>
                </div>

                <!-- Help & Support -->
                <div class="col-md-2 col-sm-6">
                    <h6 class="footer-title">Help & Support</h6>
                    <ul class="footer-list">
                        <li>About Us</li>
                        <li>FAQ</li>
                        <li>Terms & Conditions</li>
                        <li>Privacy Policy</li>
                        <li>Shipping & Delivery</li>
                        <li>Cancellation & Return</li>
                    </ul>
                </div>

                <!-- Contact -->
                <div class="col-md-3">
                    <h6 class="footer-title">Contact Us</h6>
                    <p class="footer-text">
                        WhatsApp us: <strong>70003 70003</strong><br>
                        Call us: <strong>1800 890 1222</strong><br>
                        <small>8:00 AM to 8:00 PM, 365 days</small>
                    </p>

                    <h6 class="footer-title mt-3">Download the app</h6>
                    <div class="d-flex gap-2">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/7/78/Google_Play_Store_badge_EN.svg"
                            height="40" alt="Google Play">
                        <img src="https://developer.apple.com/assets/elements/badges/download-on-the-app-store.svg"
                            height="40" alt="App Store">
                    </div>
                </div>

            </div>

            <hr class="footer-divider mt-4">

            <div class="d-flex flex-column flex-md-row justify-content-between align-items-center pb-3">
                <small class="text-muted">
                    Â© 2025 All rights reserved. Reliance Retail Ltd.
                </small>
                <small class="text-muted">
                    Best viewed on Edge, Firefox, Safari & Chrome
                </small>
            </div>
        </div>
    </footer>
{% else %}
    <footer class="jm-footer mt-auto pt-5 h6">
        <div class="container">
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-center pb-3">
                <small class="text-muted">
                    Â© 2025 All rights reserved. Reliance Retail Ltd.
                </small>
                <small class="text-muted">
                    Best viewed on Edge, Firefox, Safari & Chrome
                </small>
            </div>
        </div>
    </footer>
{% endif %}

<!-- ================= END Footer CONTENT ================= -->


<!-- ================= ADDRESS DRAWER ================= -->
<div class="address-drawer-overlay" id="addressDrawerOverlay"></div>

<div class="address-drawer" id="addressDrawer">

    <!-- HEADER -->
    <div class="address-drawer-header">
        <h5>
            <i class="bi bi-geo-alt"></i> Select Delivery Address
        </h5>
        <button onclick="closeAddressDrawer()" class="btn-close"></button>
    </div>

    <!-- BODY -->
    <div class="address-drawer-body">

        <!-- SAVED ADDRESSES -->
        <div id="saved-addresses">
            {% for address in addresses %}
            <label class="address-card">
                <input type="radio" name="address_id" value="{{ address.id }}">
                <div>
                    <strong>{{ address.full_name }}</strong><br>
                    {{ address.address_line }}, {{ address.city }}<br>
                    {{ address.state }} - {{ address.pincode }}
                </div>
            </label>
            {% empty %}
            <p class="text-muted">No saved addresses.</p>
            {% endfor %}
        </div>

        <hr>

        <!-- ADD NEW ADDRESS -->
        <h6>Add New Address</h6>
        <form id="addAddressForm">
            {% csrf_token %}
            <input class="form-control mb-2" name="full_name" placeholder="Full Name" required>
            <input class="form-control mb-2" name="phone" placeholder="Phone" required>
            <textarea class="form-control mb-2" name="address_line" placeholder="Address" required></textarea>
            <input class="form-control mb-2" name="city" placeholder="City" required>
            <input class="form-control mb-2" name="state" placeholder="State" required>
            <input class="form-control mb-3" name="pincode" placeholder="Pincode" required>

            <button type="submit" class="btn btn-outline-primary w-100">
                Save Address
            </button>
        </form>

    </div>

    <!-- FOOTER -->
    <div class="address-drawer-footer">
        <button class="btn btn-success w-100" onclick="confirmAddressAndCheckout()">
            Deliver to this Address
        </button>
    </div>

</div>

<!-- ================= LOGIN REQUIRED MODAL ================= -->
<div class="modal fade" id="loginRequiredModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg rounded-4">
            <div class="modal-body text-center p-4">
                <div class="mb-3">
                    <i class="bi bi-lock-fill text-primary" style="font-size:3rem;"></i>
                </div>
                <h5 class="fw-bold mb-2">Login Required</h5>
                <p class="text-muted mb-4">
                    Please login to continue shopping on JioMart ðŸ›’
                </p>
                <div class="d-flex justify-content-center gap-3">
                    <button class="btn btn-outline-secondary px-4"
                            data-bs-dismiss="modal">
                        Cancel
                    </button>
                    <a href="{% url 'accounts:login' %}" class="btn btn-primary px-4">
                        Login
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ================= SCRIPTS ================= -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static 'js/cart.js' %}"></script>

<script>
    function scrollNav(amount) {
        document.getElementById("navScroll")
            .scrollBy({ left: amount, behavior: "smooth" });
    }


function scrollSection(button, amount) {
    const wrapper = button.closest(".scroll-wrapper");
    const row = wrapper.querySelector(".product-row");

    row.scrollBy({ left: amount, behavior: "smooth" });
}
</script>

<script src="{% static 'js/common.js' %}"></script>
{% block extra_js %}{% endblock %}

</body>
</html>